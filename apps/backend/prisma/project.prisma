// App: env config per organization (org = project). Public schema.
model OrganizationEnv {
  id             String   @id @default(cuid())
  organizationId String   // org id from better_auth.organization
  env            String   // "development" | "staging" | "production"
  baseUrl        String?
  apiKey         String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, env])
  @@map("organization_env")
  @@schema("public")
}

// Ingest: HTTP request logs from SDK (per project/env).
model RequestLog {
  id             String   @id @default(cuid())
  organizationId String
  env            String   // "development" | "staging" | "production"
  requestId      String
  tracingId      String
  method         String
  route          String
  statusCode     Int
  durationMs     Int
  responseSize   Int      @default(0)
  timestamp      DateTime
  createdAt      DateTime @default(now())

  @@index([organizationId, env])
  @@index([organizationId, env, timestamp])
  @@map("request_log")
  @@schema("public")
}

// Ingest: API explorer JSON from SDK (route tree / tracelet.doc.json resolved per project/env).
model ApiExplorerSnapshot {
  id             String   @id @default(cuid())
  organizationId String
  env            String
  data           Json     // TraceletMeta[] or route tree from @tracelet/core
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, env])
  @@map("api_explorer_snapshot")
  @@schema("public")
}
